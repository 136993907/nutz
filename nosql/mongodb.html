<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
<title>MongoDB的薄封装(nutzmongo库)</title><link href="../zdoc.css" rel="stylesheet" type="text/css"/>
</head>
<body><a name="top"></a>
<div class="zdoc_header">MongoDB的薄封装(nutzmongo库)</div>
<div class="zdoc_author"><em>By:</em><b>wendal</b><a href="mailto:wendal1985@gmail.com">&lt;wendal1985@gmail.com&gt;</a></div>
<div class="zdoc_body">
<ul class="zdoc_index_table">
<li>
<div><span class="num">1</span><a href="#简介">简介</a></div>
</li>
<li>
<div><span class="num">2</span><a href="#添加依赖">添加依赖</a></div>
</li>
<li>
<div><span class="num">3</span><a href="#声明Ioc_Bean">声明Ioc Bean</a></div>
</li>
<li>
<div><span class="num">4</span><a href="#Service中的注入和使用">Service中的注入和使用</a></div>
</li>
<li>
<div><span class="num">5</span><a href="#关于日志">关于日志</a></div>
</li>
</ul>
<div class="hr"><b></b></div>
<h1><a name="简介"></a>简介</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>MongoDB 驱动的薄封装, 主要是封装Pojo&lt;-&gt;BasicDbObject的转换, 支持mongodb java driver 3.0+</p>
<p>项目地址: https://github.com/nutzam/nutzmongo</p>
<div class="hr"><b></b></div>
<h1><a name="添加依赖"></a>添加依赖</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>maven 的配置</p>
<pre>	&lt;dependency&gt;
		&lt;groupId&gt;org.nutz&lt;/groupId&gt;
		&lt;artifactId&gt;nutzmongo&lt;/artifactId&gt;
		&lt;version&gt;1.r.60&lt;/version&gt;
	&lt;/dependency&gt;
	&lt;!-- 其他依赖 --&gt;
</pre>
<p>直接下载jar </p>
<ul type="disc">
<li>正式版本: https://jfrog.nutz.cn/artifactory/jcenter/org/nutz/nutzmongo/</li>
<li>快照版本: https://jfrog.nutz.cn/artifactory/snapshots/org/nutz/nutzmongo/</li>
</ul>
<div class="hr"><b></b></div>
<h1><a name="声明Ioc_Bean"></a>声明Ioc Bean</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<pre>var ioc={
    <span class="zdoc_code_cmt">// 单机
</span>	zMongo : {
		args : ["127.0.0.1", 27017], <span class="zdoc_code_cmt">// 或者不写参数，默认就是127.0.0.1和27017
</span>		factory : "org.nutz.mongo.ZMongo<span class="zdoc_code_cmt">#me"
</span>	},
	<span class="zdoc_code_cmt">// 集群
</span>	<span class="zdoc_code_cmt">//zMongo : {
</span>	<span class="zdoc_code_cmt">//	args : ["mongodb://root:mypass@192.168.2.199:3717,192.168.2.200:3717/admin?replicaSet=mgset"], // 基于Mongo URI创建ZMongo
</span>	<span class="zdoc_code_cmt">//	factory : "org.nutz.mongo.ZMongo#uri"
</span>	<span class="zdoc_code_cmt">//},
</span>	zMoDB : {
		args : ["nutzbook"], <span class="zdoc_code_cmt">// 数据库名称
</span>		factory : "$zMongo<span class="zdoc_code_cmt">#db"
</span>	},
	<span class="zdoc_code_cmt">// 集合,可以在这里声明,也可以走@Inject注入
</span>	zMoCoUser : {
		args : ["user"],
		factory : "$zMoDB<span class="zdoc_code_cmt">#c"
</span>	}
	/* <span class="zdoc_code_cmt">// 还可以声明几个常用的集合,也可以在Service中生成
</span>	,zMoCoTopic : {
		args : ["topic", false],
		factory : "$zMoDB<span class="zdoc_code_cmt">#cc"
</span>	},
	zMoCoReply : {
		args : ["reply", false],
		factory : "$zMoDB<span class="zdoc_code_cmt">#cc"
</span>	}
	*/
}
</pre>
<div class="hr"><b></b></div>
<h1><a name="Service中的注入和使用"></a>Service中的注入和使用</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<pre>@IocBean
public class XXXService {
	<span class="zdoc_code_cmt">// 按需注入几个核心对象
</span>	@Inject 
	protected ZMongo zmongo;  <span class="zdoc_code_cmt">//注意大小写与配置的名字一致
</span>	@Inject
	protected ZMoDB zMoDB; <span class="zdoc_code_cmt">// 当前数据
</span>	
	@Inject ZMoCo zMoCoUser; <span class="zdoc_code_cmt">// 按js里面的配置取
</span>	
	@Inject("java:$zMoDB.c('role')") <span class="zdoc_code_cmt">// 也可以直接取. 当然了,也可以代码调用zMoDB.c(集合名词)来动态获取
</span>	ZMoCo zMoCoRole;
	
	public void insert(User...users) {
		zMoCoUser.insert(ZMo.toDocArray(users));
	}
	
	public List&lt;User&gt; query(ZMoDoc cnd) {
		List&lt;User&gt; list = new ArrayList&lt;User&gt;();
		DBCursor cursor = MoCoUser.find(cnd);
		if(cursor.hasNext()) {
   			DBObject obj = cursor.next();
   			list.add(ZMo.me().fromDocToObj(obj, User.class));
		}
		return list;
	}
	
	<span class="zdoc_code_cmt">// ZMoCo还有很多方法哦，请挖掘
</span>}
</pre>
<div class="hr"><b></b></div>
<h1><a name="关于日志"></a>关于日志</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>nutzmongo内的日志大部分是ZMoCo输出的, 走的也是nutz的Log接口. 若使用log4j, 下面是参考配置</p>
</div>
<div class="zdoc_footer"><em>By:</em><b>wendal</b><a href="mailto:wendal1985@gmail.com">&lt;wendal1985@gmail.com&gt;</a></div>
</body>
</html>