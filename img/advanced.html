<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
<title>更高级的方法</title><link href="../zdoc.css" rel="stylesheet" type="text/css"/>
</head>
<body><a name="top"></a>
<div class="zdoc_header">更高级的方法</div>
<div class="zdoc_author"><em>By:</em><b>wendal(wendal1985@gmail.com), pangwu86</b><a href="mailto:pangwu86@gmail.com">&lt;pangwu86@gmail.com&gt;</a></div>
<div class="zdoc_body">
<ul class="zdoc_index_table">
<li>
<div><span class="num">1</span><a href="#所谓的高级">所谓的高级</a></div>
</li>
<li>
<div><span class="num">2</span><a href="#添加水印">添加水印</a></div>
</li>
<li>
<div><span class="num">3</span><a href="#生成文字">生成文字</a></div>
</li>
<li>
<div><span class="num">4</span><a href="#生成头像">生成头像</a></div>
</li>
<li>
<div><span class="num">5</span><a href="#生成验证码">生成验证码</a></div>
</li>
<li>
<div><span class="num">6</span><a href="#灰度图">灰度图</a></div>
</li>
<li>
<div><span class="num">7</span><a href="#三原色通道">三原色通道</a></div>
</li>
<li>
<div><span class="num">8</span><a href="#正片叠底效果">正片叠底效果</a></div>
</li>
<li>
<div><span class="num">9</span><a href="#抠图方法1">抠图方法1</a></div>
</li>
<li>
<div><span class="num">10</span><a href="#抠图方法2">抠图方法2</a></div>
</li>
</ul>
<div class="hr"><b></b></div>
<h1><a name="所谓的高级"></a>所谓的高级</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>其实就是针对一些图片实际使用场景而封装的方法，因为生成结果是图片不方便验证结果，所以请自行肉眼判断</p>
<div class="hr"><b></b></div>
<h1><a name="添加水印"></a>添加水印</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>添加位置默认提供9个选择:</p>
<ol type="1">
<li>Images.WATERMARK_TOP_LEFT</li>
<li>Images.WATERMARK_TOP_CENTER</li>
<li>Images.WATERMARK_TOP_RIGHT</li>
<li>Images.WATERMARK_CENTER_LEFT</li>
<li>Images.WATERMARK_CENTER</li>
<li>Images.WATERMARK_CENTER_RIGHT</li>
<li>Images.WATERMARK_BOTTOM_LEFT</li>
<li>Images.WATERMARK_BOTTOM_CENTER</li>
<li>Images.WATERMARK_BOTTOM_RIGHT</li>
</ol>
<p>例如：上面中间添加图片水印, 75%透明度，10像素边距</p>
<pre>img = Images.addWatermark(bgImg, watermarkImg,  0.75f, Images.WATERMARK_TOP_CENTER, 10);
</pre>
<p>效果如图：</p>
<p><img src="watermark.jpg"/></p>
<div class="hr"><b></b></div>
<h1><a name="生成文字"></a>生成文字</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>根据文字生成图片的小工具，文字会自动居中。</p>
<p>直接生成黑底白字</p>
<pre>img = Images.createText("随便写");
</pre>
<p>手动设置图片大小，文字/背景色，字体，字体样式, 字体大小等</p>
<pre>img = Images.createText("这是非常长的一句话，你可能会觉得真的有那么长吗，是的还是挺长的", 1100, 200, "<span class="zdoc_code_cmt">#F00", "#FF0", "微软雅黑", 32, Font.PLAIN);
</span></pre>
<p>效果如图：</p>
<p><img src="createText.jpg"/></p>
<div class="hr"><b></b></div>
<h1><a name="生成头像"></a>生成头像</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>根据文字生成图片的小工具，适用于一些生成头像的场景。这里根据文字长度做了一点限制，2字以内显示，超过只显示第一个文字。</p>
<p>直接生成黑底白字</p>
<pre>img = Images.createAvatar("王小二");
</pre>
<p>效果如图：</p>
<p><img src="a1.jpg"/></p>
<p>手动设置图片大小，文字/背景色，字体，字体样式, 字体大小等</p>
<pre>img = Images.createAvatar("小二", 256, "rgba(255,0,0,1)", "rgb(0,0,255)", "微软雅黑", 64, Font.ITALIC);
</pre>
<p>效果如图：</p>
<p><img src="a2.jpg"/></p>
<div class="hr"><b></b></div>
<h1><a name="生成验证码"></a>生成验证码</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>将指定的文字内容生成验证码。验证码的生成步骤如下：</p>
<p>1. 随机选择颜色与字体2. 文字写入3. 添加干扰线4. 图像整体进行扭曲</p>
<p>对于验证码内容，可以使用Nutz中Lang包提供的R.captchaNumber或R.captchaChar，也可以填入任意内容。</p>
<p>比如生成6位数字验证码：</p>
<pre>img = Images.createCaptcha(R.captchaNumber(6));
</pre>
<p>效果如下：</p>
<p><img src="cpn6.jpg"/></p>
<p>比如生成6位字符+数字验证码：</p>
<pre>img = Images.createCaptcha(R.captchaChar(6));
</pre>
<p>效果如下：</p>
<p><img src="cpc6.jpg"/></p>
<p>如果要生成其他字符的，比如中文，则需要手动指定字体名称，否者容易产生乱码：</p>
<pre>img = Images.Images.createCaptcha("胖五是好人", 0, 0, null, "<span class="zdoc_code_cmt">#FFF", "微软雅黑");
</span></pre>
<p>效果如下：</p>
<p><img src="cpchinese.jpg"/></p>
<p>也可以指定前后背景颜色，这样不会显得那么花哨了：</p>
<pre>img  = Images.createCaptcha(R.captchaChar(10), 0, 0, "<span class="zdoc_code_cmt">#000", "#FFF", null);
</span></pre>
<p>效果如下：</p>
<p><img src="cphb.jpg"/></p>
<div class="hr"><b></b></div>
<h1><a name="灰度图"></a>灰度图</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>变灰度图的原理就是将每个像素的RGB值设置成一样，这样整个图片只有黑白与中间的过渡色了。</p>
<pre>img = Images.grayImage(srcImg);
</pre>
<p>原图：</p>
<p><img src="zn.jpg"/></p>
<p>灰度图：</p>
<p><img src="znGray.jpg"/></p>
<div class="hr"><b></b></div>
<h1><a name="三原色通道"></a>三原色通道</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>熟悉PS的同学应该知道通道这个概念， 这里提供了直接生成各个通道的图片的方法</p>
<p><img src="znChannel.png"/></p>
<p>通道的选项：</p>
<ul type="disc">
<li>Images.CHANNEL_RED</li>
<li>Images.CHANNEL_GREEN</li>
<li>Images.CHANNEL_BLUE</li>
</ul>
<pre>img = Images.channelImage(srcImg, Images.CHANNEL_RED);
</pre>
<p>红色通道图：</p>
<p><img src="znRed.jpg"/></p>
<p>绿色通道图：</p>
<p><img src="znGreen.jpg"/></p>
<p>蓝色通道图：</p>
<p><img src="znBlue.jpg"/></p>
<div class="hr"><b></b></div>
<h1><a name="正片叠底效果"></a>正片叠底效果</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>这算是比较高级的图像处理了，PS中可以通过修改图层上的设置而达到效果。</p>
<p>具体的实现原理可以看下这个文章 <a href="http://www.68ps.com/jc/big_ps_zz.asp?id=130">《图层混合模式“正片叠底”颜色计算公式的详解》</a>，讲的还算通俗。</p>
<p>下面这个图可以说是最佳示例了：</p>
<p><img src="zpdd.jpg"/></p>
<pre>img = Images.multiply(bgImg, itemImg, 0, 0);
</pre>
<p>使用场景么，一般可用于两张图片融合，比如给金将军加个太阳什么的</p>
<p>将军图：</p>
<p><img src="zn.jpg"/></p>
<p>太阳图：</p>
<p><img src="sun.jpg"/></p>
<p>正片叠底后的效果：</p>
<p><img src="znSun.jpg"/></p>
<div class="hr"><b></b></div>
<h1><a name="抠图方法1"></a>抠图方法1</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>通过指定背景像素，然后遍历像素后，在指定范围内的就当做背景然后设置为透明。</p>
<p>该方法适合背景与前景相差特别大的图片，最好是背景颜色基本一致，前景背景有明显分隔界限。</p>
<p>比如来个机器猫：</p>
<p><img src="ddm.png"/></p>
<p>选区0，0像素当做背景即可，范围20</p>
<pre>img = Images.cutoutByPixel(srcImg, 0, 0, 20);
</pre>
<p>抠图后：</p>
<p><img src="ddmCut.png"/></p>
<div class="hr"><b></b></div>
<h1><a name="抠图方法2"></a>抠图方法2</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>通过指定某个通道或采用亮度作为透明的依据进行图片透明处理。</p>
<p>比如这个蓝色火焰与黑色背景融合在一起的图：</p>
<p><img src="fire.jpg"/></p>
<p>如果采用指定背景进行Cut，效果如下：</p>
<p><img src="fireCut.png"/></p>
<p>很明显，这样过渡区域的像素处理的很不自然。</p>
<p>通过亮度来抠图:</p>
<pre>img = Images.cutoutByLuminance(srcImg);
</pre>
<p>效果如图：</p>
<p><img src="fireLu.png"/></p>
<p>看上去好多了，但是蓝色被消除的太多了，再改用蓝色通道进行抠图：</p>
<pre>img = Images.cutoutByChannel(srcImg, Images.CHANNEL_BLUE);
</pre>
<p>效果如图：</p>
<p><img src="fireC2.png"/></p>
<p>该例子引用了 <a href="http://www.cnblogs.com/wangjunxiao/p/6700920.html">~的星辰大海的这篇blog </a>，有兴趣看原理的可以了解下。</p>
</div>
<div class="zdoc_footer"><em>By:</em><b>wendal(wendal1985@gmail.com), pangwu86</b><a href="mailto:pangwu86@gmail.com">&lt;pangwu86@gmail.com&gt;</a></div>
</body>
</html>