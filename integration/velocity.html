<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8"/>
<title>集成Velocity</title><link href="../zdoc.css" rel="stylesheet" type="text/css"/>
</head>
<body><a name="top"></a>
<div class="zdoc_header">集成Velocity</div>
<div class="zdoc_author"><em>By:</em><b>wendal</b><a href="mailto:wendal1985@gmail.com">&lt;wendal1985@gmail.com&gt;</a></div>
<div class="zdoc_body">
<ul class="zdoc_index_table">
<li>
<div><span class="num">1</span><a href="#将nutz-plugins-views加入到项目中">将nutz-plugins-views加入到项目中</a></div>
</li>
<li>
<div><span class="num">2</span><a href="#修改MainModule类,添加引用">修改MainModule类,添加引用</a></div>
</li>
<li>
<div><span class="num">3</span><a href="#在classpath下添加velocityproperties">在classpath下添加velocity.properties</a></div>
</li>
<li>
<div><span class="num">4</span><a href="#webxml配置">web.xml配置</a></div>
</li>
<li>
<div><span class="num">5</span><a href="#使用方法">使用方法</a></div>
</li>
<li>
<div><span class="num">6</span><a href="#更灵活的使用方法">更灵活的使用方法</a></div>
</li>
<li>
<div><span class="num">7</span><a href="#可供参考的实例项目">可供参考的实例项目</a></div>
</li>
</ul>
<div class="hr"><b></b></div>
<h1><a name="将nutz-plugins-views加入到项目中"></a>将nutz-plugins-views加入到项目中</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>手动下载地址: https://jfrog.nutz.cn/artifactory/jcenter/org/nutz/nutz-plugins-views/</p>
<p>maven项目的依赖项,中央库有.</p>
<pre>	&lt;dependency&gt;
		&lt;groupId&gt;org.nutz&lt;/groupId&gt;
		&lt;artifactId&gt;nutz-plugins-views&lt;/artifactId&gt;
		&lt;version&gt;1.r.60&lt;/version&gt;
	&lt;/dependency&gt;
</pre>
<p>maven引用velocity相关jar包</p>
<pre>	&lt;dependency&gt;
		&lt;groupId&gt;org.apache.velocity&lt;/groupId&gt;
		&lt;artifactId&gt;velocity&lt;/artifactId&gt;
		&lt;version&gt;1.7&lt;/version&gt;
	&lt;/dependency&gt;
	&lt;dependency&gt;
			&lt;groupId&gt;org.apache.velocity&lt;/groupId&gt;
			&lt;artifactId&gt;velocity-tools&lt;/artifactId&gt;
			&lt;version&gt;2.0&lt;/version&gt;
	&lt;/dependency&gt;
</pre>
<div class="hr"><b></b></div>
<h1><a name="修改MainModule类,添加引用"></a>修改MainModule类,添加引用</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<pre>@Views(value={VelocityViewMaker.class})
<span class="zdoc_code_cmt">// 其他配置,如IocBy等等
</span>public class MainModule {}
</pre>
<div class="hr"><b></b></div>
<h1><a name="在classpath下添加velocityproperties"></a>在classpath下添加velocity.properties</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<pre><span class="zdoc_code_cmt">#资源加载器或加载器别名
</span>resource.loader = webapp
<span class="zdoc_code_cmt">#资源加载器类全限定名
</span>webapp.resource.loader.class = org.apache.velocity.tools.view.WebappResourceLoader
<span class="zdoc_code_cmt">#资源位置
</span>webapp.resource.loader.path=/WEB-INF/
<span class="zdoc_code_cmt">#编码
</span>input.encoding=UTF-8
output.encoding=UTF-8
<span class="zdoc_code_cmt">#布局文件为准
</span>tools.view.servlet.layout.directory = layout/
<span class="zdoc_code_cmt">#默认布局文件名称
</span>tools.view.servlet.layout.default.template =default.html
<span class="zdoc_code_cmt">#默认错误文件名称
</span>tools.view.servlet.error.template =Error.vm
tools.view.servlet.layout.default.template =Default.vm
</pre>
<div class="hr"><b></b></div>
<h1><a name="webxml配置"></a>web.xml配置</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<pre>&lt;init-param&gt;
	&lt;param-name&gt;org.apache.velocity.properties&lt;/param-name&gt;&lt;!-- 这个不能修改--&gt;
	&lt;param-value&gt;velocity.properties&lt;/param-value&gt; &lt;!-- 对应上一步中配置文件的位置 --&gt;
&lt;/init-param&gt;
</pre>
<div class="hr"><b></b></div>
<h1><a name="使用方法"></a>使用方法</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>User类</p>
<pre>public class User {
	public int roleId;
	public String userName;

public int getRoleId() {
	return roleId;
}

public void setRoleId(int roleId) {
	this.roleId = roleId;
}

public String getUserName() {
	return userName;
}

public void setUserName(String userName) {
	this.userName = userName;
}
}
</pre>
<p>MVC类</p>
<pre>@At("/")
@Ok("vm:/tmpl/main.vm")
public User main() {
	User user = new User();
	user.setUserName("nutz");
	user.setRoleId(0);
	return user;
}
</pre>
<p>main.vm文件</p>
<pre><span class="zdoc_code_cmt">#if($!{obj.roleId} == 0)
</span>&lt;li&gt; 管理员 $!{obj.userName}&lt;/li&gt;
<span class="zdoc_code_cmt">#else
</span>&lt;li&gt; 编辑 $!{obj.userName}&lt;/li&gt;
<span class="zdoc_code_cmt">#end
</span></pre>
<div class="hr"><b></b></div>
<h1><a name="更灵活的使用方法"></a>更灵活的使用方法</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>MVC类</p>
<pre>@At("/")
@Ok("vm:/tmpl/main.vm")
public NutMap main() {
	NutMap map = new NutMap();
	map.put("site_name", "Nutz工具箱");
	User user = new User();
	user.setRoleId(0);
	user.setUserName("nutz");
	map.put("user", user);
	return map;
}
</pre>
<p>main.vm文件</p>
<pre>&lt;span&gt; 站点名称：$!{obj.site_name}&lt;/span&gt;
<span class="zdoc_code_cmt">#if($!{obj.user.roleId} == 0)
</span>&lt;li&gt; 管理员 $!{obj.user.userName}&lt;/li&gt;
<span class="zdoc_code_cmt">#else
</span>&lt;li&gt; 编辑 $!{obj.user.userName}&lt;/li&gt;
<span class="zdoc_code_cmt">#end
</span></pre>
<div class="hr"><b></b></div>
<h1><a name="可供参考的实例项目"></a>可供参考的实例项目</h1>
<div style="float:right;"><a href="#top">Top</a></div>
<p>https://github.com/Wizzercn/NutzWk</p>
</div>
<div class="zdoc_footer"><em>By:</em><b>wendal</b><a href="mailto:wendal1985@gmail.com">&lt;wendal1985@gmail.com&gt;</a></div>
</body>
</html>